import smtplib 
from email.mime.text import MIMEText 
from email.mime.multipart import MIMEMultipart
from email.mime.base import MIMEBase
from email import encoders 
import traceback
import configparser

config = configparser.ConfigParser()
config.read('config.ini')

def send_mail(receiver_email, spoofed_email, spoofed_name, message, subject):
    try:
        msg = MIMEMultipart("related")
        msg['From'] = f"{spoofed_name} <{spoofed_email}>"
        msg['To'] = receiver_email
        msg['Subject'] = subject
        body = message
        msg.attach(MIMEText(body, 'plain'))
        
        smtp_host = config.get('SMTP', 'host')
        smtp_port = config.getint('SMTP', 'port')
        smtp_username = config.get('SMTP', 'username')
        smtp_password = config.get('SMTP', 'password')
        
        server = smtplib.SMTP(smtp_host, smtp_port)
        server.starttls()
        server.login(smtp_username, smtp_password)
        
        text = msg.as_string()
        server.sendmail(spoofed_email, receiver_email, text)
        server.quit()
        
        print('Email sent successfully to ' + receiver_email + ' from ' + spoofed_name)
    except Exception as e:
        print('An error occurred:')
        print(traceback.format_exc())
        print('Email could not be sent to ' + receiver_email)

receiver_email = <receiver email>
spoofed_email = <spoofed sender>
spoofed_name = <spoofed name>
message = <txt>
subject = <subject>

send_mail(receiver_email, spoofed_email, spoofed_name, message, subject)
